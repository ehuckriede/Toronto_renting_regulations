---
title: "results_paper"
author: "DPREP Team 16"
date: "17/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(haven)
library(tidyverse)
library(ggplot2)
library(gapminder)
library(knitr)
library(recommenderlab)
library(RColorBrewer)
```

## **Results linear regression**

To create the linear model, the cleaned dataset is loaded into the R script. Then, a linear model is made by using the price as the dependent variable, the regulation as the independent variable and then the different neighborhoods and roomtypes are added as covariates, as well as the other three dummy's: host_since_dummy, superhost_dummy and identity_verified_dummy. For a more elaborate explanation on these variables, please read the paper in the sourcecode datapreparation folder.

When running this regression, the results are as follows: 
```{r}
cleaned_data <- read.csv(file = '../../gen/data-preparation/output/cleaned_data.csv')
price_lm <- lm(price ~ regulation + old_town + etobicoke + north_york + east_york + york + entire_home_apt + hotel_room + private_room + host_since_dummy + superhost_dummy + identity_verified_dummy, cleaned_data)
summary(price_lm)
```
Here, it is directly noticeable that regulation has a significant, positive influence on the price. All covariates, except for the identity_verified_dummy, also have a significant influence on the listing price. From this, it can be concluded that not only regulation has had a significant impact on the price, but these covariates as well. However, these effects can also go hand in hand; when the regulation was made official, the offer for several room types such as entire homes or apartments would significantly decrease, as way less people could offer such accommodation. The scarcity for this room type can also lead to an increase in price. 

*Note that for example, not all neighborhoods and room_type have a significant influence on the price. However, to draw the conclusion that being in a specific neighborhood and having a specific room type to offer has a significant impact on the price, having one significant dummy is already enough, as this shows that at least one neighborhood or roomtype is significant for the price.* 

## **Data visualization**
### **Data retrieval plots**
To obtain the data for all the plots created, several files were created for the specific plots. 

#### **General barplot**
First, a general barplot will be made, which will just show the increase in price before and after te regulation. This result will be shared in the Github Readme, as it is the most concise conclusion. 

The following code is used for the general barplot. The results of this data are written to a csv file to make the data easily accessible in other files.
```{r}
# --- Load Data --- #
all_data <- read.csv(file = '../../gen/data-preparation/output/cleaned_data.csv')

# --- Data for Plot 3 --- #

regulation_price <- all_data %>%
  group_by(regulation) %>%
  summarise(price = mean(price))

write.csv(regulation_price, "../../gen/analysis/input/data_for_barplot.csv", row.names = FALSE)
```

####**Neighborhood plot**
Next, also a barplot containing the price difference per neighborhood is included. The structure of this data retrieval code is a bit more complex, as the data has to be pivoted into a long format first. In the end, a dataset containing the neighborhoods and the regulation, summarized by the means, has been created. This dataset is once again written to a csv file. 

```{r}
# --- Load Data --- #
neighborhood_data <- read.csv(file = '../../gen/data-preparation/output/cleaned_data.csv')

# --- Data for Plot 3 --- #
# Transform neighborhood_data into a pivot long format
neighborhoods_long <- neighborhood_data %>% 
  pivot_longer(cols = old_town:scarborough,
               names_to = "neighborhood",
               values_to = "neigbhorhood_logical")

# Transform the neighborhood_logical column to actual logical values
neighborhoods_long <- neighborhoods_long %>%
  mutate(as.logical(neigbhorhood_logical))

# Filter out the FALSE values
neighborhoods_long <- neighborhoods_long %>% 
  filter(`as.logical(neigbhorhood_logical)`) %>% 
  select(-`as.logical(neigbhorhood_logical)`) 

# Summarise the means of every type of neighborhood before and after regulation
neighborhoods_price_long <- neighborhoods_long %>% 
  group_by(neighborhood, regulation) %>%
  summarise(price = mean(price))

write.csv(neighborhoods_price, "../../gen/analysis/input/data_for_plot_neighborhoods.csv", row.names = FALSE)
```
#### **Room type plot**
Last, we also include a plot that visualizes the difference in prices before and after the regulation for the room types. The retrieval of the data has been done in a similar way. 

```{r}
# --- Load Data --- #
all_data <- read.csv(file = '../../gen/data-preparation/output/cleaned_data.csv')

# --- Data for Plot 1 --- #

roomtype_price <- all_data %>%
  group_by(room_type, regulation) %>%
  summarise(price = mean(price))

dir.create('../../gen/analysis/input/', recursive = T)
write.csv(roomtype_price, "../../gen/analysis/input/data_for_roomtype_plot.csv", row.names = FALSE)
```


## **Barplots**
### **Barplot general prices**
The following plot has been made based on the data retrieved. This plot visually represents the mean price increase before and after the regulation. 

```{r, echo=FALSE}
# --- Load Data --- #
regulation_price <- read.csv(file = '../../gen/analysis/input/data_for_barplot.csv')
regulation_price$regulation <- as.factor(regulation_price$regulation)

# Create barplot 
regulation_price %>% 
  ggplot(aes(x=regulation, y=price, fill = regulation)) +
  geom_bar(stat = "identity", position = "dodge2") + 
  xlab("Before or After Regulation") + ylab("Mean Price") + 
  ggtitle("Mean Price before and after regulation") + 
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank()) + 
  guides(fill = guide_legend(title = "Regulation")) + 
  scale_fill_discrete(labels = c("Before Regulation", "After Regulation")) + geom_col()
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
